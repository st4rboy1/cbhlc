#!/bin/bash

echo "ğŸš€ Running pre-push checks..."
echo ""

# Run the local test script
./scripts/test-local.sh

# Check if the local test script passed
if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Pre-push checks failed! Fix the issues before pushing."
    echo ""
    echo "Tip: You can bypass this check with 'git push --no-verify' (not recommended)"
    exit 1
fi

# Run tests with coverage
echo ""
echo "ğŸ§ª Running tests with coverage check..."
./vendor/bin/sail pest --coverage --min=60 --coverage-html=coverage --coverage-clover=coverage.xml

# Check the exit status
if [ $? -ne 0 ]; then
    echo "âŒ Tests failed or coverage below 60%. Push aborted."
    exit 1
fi

echo "âœ… All tests passed with minimum 60% coverage!"
echo "âœ… Pre-push checks completed successfully!"
exit 0